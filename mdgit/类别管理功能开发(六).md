## 类别新增

上章中我们建立了一个类别新增按钮。现在我们为该按钮填充事件。

添加新增类别按钮，点击按钮弹出空白类别信息表单对话框，填写后点击提交表单数据。

### 组件引入

绘制组件前先将组件引入，方便调试。

- 创建文件views/category/deit.vue，添加占位内容。

  ```html
  <template>
      <div>123</div>
  </template>
  ```

- 将组件引入views/category/index.vue中。

  ```html
  <script>
  	... ...
  	import Edit from './edit.vue'
  	export default {
  		... ...
  		components: { Edit },
  		... ...
  	}
  </script>
  ```

- 将组件标签放置到父组件template末尾，查看效果。

  ```html
  <template>
      <div>
          <el-form>...</el-form>
          <el-table>...</el-table>
          <el-pagination></el-pagination>
          <edit></edit>
      </div>
  </template>   
  ```

子组件内容 123 出现在页面下方，组件引入成功。

### 组件页面绘制

在刚刚子组件中绘制含表单的对话框。

组件参考element-ui对话框和表单文档。

#### 绘制对话框

```html
<template>
    <el-dialog
        title="新增"
        :visible.sync="dialogVisible"
        width="30%"
        :before-close="handleClose">
        <span>绘制表单</span>
        <span slot="footer" class="dialog-footer">
            <el-button @click="dialogVisible = false">取 消</el-button>
            <el-button type="primary" @click="dialogVisible = false">确 定</el-button>
        </span>
    </el-dialog>
</template>
```

上图来自element-ui对话框文档，经过了部分修改，其中visible为对话框是否弹出(显示)项，dialogVisible变量为一个Boolean值，后期来自父组件传入，现将其设置初始值即可。

before-close为点击关闭按钮触发的回调。

这部分代码中有一个变量dialogVisible，方法handleClose需要给出。

#### 绘制表单

```html
        <!-- <span>绘制表单</span> -->

        <el-form 
        status-icon
        :model="formData"
        style="width: 400px;"
        label-width="100px"
        label-position="right"           
        >
            <el-form-item label="分类名称:" prop="name" >
                <el-input v-model="formData.name" />
            </el-form-item>
            <el-form-item label="状态:" prop="status" >
                <el-radio-group v-model="formData.status">                
                    <el-radio :label="1" >正常</el-radio>                
                    <el-radio :label="0" >禁用</el-radio>            
                </el-radio-group>
            </el-form-item>
            <el-form-item label="排序:" prop="sort" >
                <el-input-number style="width: 300px;" v-model="formData.sort" :min="1" :max="10000"/>
            </el-form-item>
            <el-form-item label="备注:" prop="remart" >
                <el-input 
                v-model="formData.remark" 
                type="textarea"             
                :autosize="{ minRows: 2, maxRows: 4}" 
                placeholder="请输入备注" />
            </el-form-item>
            <el-form-item>
                <el-button @click="handleClose" size='mini'>取 消</el-button>
                <el-button type="primary" @click="submitForm('formData')" size='mini'>确 定</el-button>
            </el-form-item>
        </el-form>
```

这部分代码中有一个变量formData，方法submitForm需要给出。

### 数据引入

变量dialogVisible，formData，和对话框标题title，为减少组件耦合性，均从父组件传入。

```js
    props: {
        dialogVisible: {
            type: Boolean,
            default: false
        },
        formData: {
            type: Object,
            default: {}
        },
        title: {
            type: String,
            default: ''
        }
    },
```

```html
        <edit 
        :title="edit.title" 
        :dialogVisible="edit.visible"           
        :formData="edit.formData"
        >
        </edit>
```

另在子组件中定义tomplate中用到的两个方法。

```js
    methods: {
        handleClose(done){
            done();
        },
        submitForm(formName){

        }
    }
```

### 方法定义

#### 对话框弹出事件

首先父组件中edit.visible值默认是false，当其为ture时对话框弹出，现在为增加按钮绑定对话框弹出事件。

```html
<el-button type="primary" icon="el-icon-circle-plus-outline" @click="openAdd()">新增</el-button>
```

```js
       openAdd(){
            this.edit.visible = true;
            this.edit.title = '新增';
        }
```

#### 对话框关闭事件

由于此刻对话框显示标志位是由父组件传入的，而子组件无法直接改变，所以需要通过触发父组件事件改变。

在父组件中定义事件remoteClos，作为关闭对话框并触发列表刷新。

```js
// 父组件中定义事件
		remoteClose(){
            this.formData = {
                'name': '',
                status: '',
                sort: '',
                remart: ''
            };
            this.edit.visible = false;
            this.fetchData();
        }
```

```html
// 父组件中 为子组件绑定事件
		<edit 
        :title="edit.title" 
        :dialogVisible="edit.visible"           
        :formData="edit.formData"
        @remote="remoteClose"
        >
        </edit>
```

```js
// 子组件中 触发事件
    methods: {
        handleClose(done){
            this.$emit("remote");
        },
        submitForm(formName){

        }
    }
```

#### 表单校验

表单验证依赖于el-form的rules属性，其值为object。

```html
        <el-form 
        status-icon
        :model="formData"
        style="width: 400px;"
        label-width="100px"
        label-position="right" 
        :rules="rules"          
        >
```

```js
    data(){
        return {
            rules: {
                name: [{required: true, message: '请输入名称', trigger: 'blur' }],
                status: [{required: true, message: '请选择状态', trigger: 'change' }],
                sort: [{required: true, message: '请输入排序号', trigger: 'change' }]
            }
        }
    }
```

如上，在rules中，name，status和sort为porps属性的值，对应表单项，required为是否必备，message为提示内容，trigger为触发校验事件。

#### 表单提交





类别删除

类别修改

